name: BingeBuddy Scheduler

on:
  schedule:
    - cron: "0 */11 * * *"  # every 11 hours (UTC)
  workflow_dispatch: {}       # allow manual runs from the Actions tab

jobs:
  run-tasks:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Run sync + conditional Sunday alerts
        env:
          # DB connectivity
          ENVIRONMENT:        ${{ secrets.ENVIRONMENT }}
          SQLITE_CLOUD_URL:   ${{ secrets.SQLITE_CLOUD_URL }}
          SQLITE_USER:        ${{ secrets.SQLITE_USER }}
          SQLITE_PASSWORD:    ${{ secrets.SQLITE_PASSWORD }}
          SQLITE_DB:          ${{ secrets.SQLITE_DB }}
          SQLITE_PORT:        ${{ secrets.SQLITE_PORT }}

          # TMDB
          DEFAULT_API_KEY:    ${{ secrets.DEFAULT_API_KEY }}

          # Alerts (email + optional SMS via email-to-SMS gateway)
          SMTP_HOST:          ${{ secrets.SMTP_HOST }}
          SMTP_PORT:          ${{ secrets.SMTP_PORT }}
          SMTP_USE_TLS:       ${{ secrets.SMTP_USE_TLS }}
          SMTP_USER:          ${{ secrets.SMTP_USER }}
          SMTP_PASS:          ${{ secrets.SMTP_PASS }}
          ALERT_SMS_CARRIER:  ${{ secrets.ALERT_SMS_CARRIER }}
          ALERT_SMS_TO:       ${{ secrets.ALERT_SMS_TO }}

        run: |
          python tasks_sync_and_alerts.py
